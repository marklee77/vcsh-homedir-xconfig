#!/bin/bash
laptop_screen=eDP1
screen_status=$(xrandr --current | perl -ne "print \"\$1\n\" if (/^$laptop_screen connected(?: primary)? (\S+) \(.*$/)")
lid_state=$(perl -ane 'print $F[1]' /proc/acpi/button/lid/LID/state)

if [ "$lid_state" = "closed" ]; then
    if ! xrandr --current | grep " connected" | grep -v ^$laptop_screen -q; then
        laptop-lock >/dev/null &
        on_ac_power || laptop-smartsleep >/dev/null
    elif [ -n "$screen_status" ]; then
        xrandr --output $laptop_screen --off
    fi
elif [ -z "$screen_status" ]; then
    xrandr --output $laptop_screen --auto --primary
fi

exit 0
